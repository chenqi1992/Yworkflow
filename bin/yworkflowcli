#!/usr/bin/env node

var chalk = require('chalk');
var optimist = require('optimist');
var argv = optimist.argv;
var spawn = require('child_process').spawn;
var path = require('path');
var absPath = '';
var shellPath = path.resolve(__dirname, '..');
var glob = require('glob');

if(argv.path) {
    absPath = path.resolve(process.env.PWD, argv.path);
} else {
    var matched = glob.sync(path.resolve(process.env.PWD, '*.yconfig'));
    if(matched.length !== 1) {
      throw new Error('工作目录发现多个.yconfig, 请调用--path 手动指定');
      return;
    }
    absPath = path.resolve(process.env.PWD, matched[0]);
}
var child = spawn('cd ' + shellPath + ' && gulp dev --path ' + absPath, { shell: true });
child.stderr.on('data', function (data) {
    console.error(data.toString());
});
child.stdout.on('data', function (data) {
    console.log(data.toString());
});
child.on('exit', function (exitCode) {
    console.log('Child exited with code: ' + exitCode);
});
